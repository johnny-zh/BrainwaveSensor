# BrainwaveSensor 脑电波传感器项目

一个基于ESP32的便携式脑电波数据采集与无线传输系统，支持实时EEG数据监测和语音状态提示。

## 项目概述

该项目实现了一个完整的脑电波数据采集解决方案，包括硬件设计和软件开发。系统能够实时采集EEG信号，通过WiFi将数据上传至后台服务器，并通过语音提示为用户提供操作反馈。

## 硬件模块

### 主要组件

* **主控MCU**: ESP32 S3 Tiny
* **EEG芯片**: TGAM (ThinkGear ASIC Module)
* **音频模块**: MAX98357 I2S数字功放
* **充放电模块**: TP4056 锂电池充电管理
* **扬声器**: 用于语音提示输出
* **锂电池**: 便携式供电
* **三脚开关**: 设备电源控制

### 硬件连接图

#### 脑电波传感器到MCU的连接

| 传感器引脚  | MCU连接端口    | 功能说明   |
| ------ | ---------- | ------ |
| VCC电源  | 3.3V       | 供电正极   |
| GND地线  | GND        | 供电负极   |
| TX数据发送 | GPIO2 (RX) | 串口接收数据 |
| RX数据接收 | GPIO1 (TX) | 串口发送数据 |

#### 音频输出模块连接

| 音频模块引脚 | MCU连接端口 | 功能说明     |
| ------ | ------- | -------- |
| SCK时钟  | GPIO4   | I2S时钟信号  |
| WS字选择  | GPIO5   | I2S字选择信号 |
| SD数据   | GPIO3   | I2S音频数据  |
| VCC电源  | 3.3V    | 供电正极     |
| GND地线  | GND     | 供电负极     |

#### RGB指示灯连接

| RGB模块引脚 | MCU连接端口 | 功能说明    |
| ------- | ------- | ------- |
| VCC电源   | 3.3V    | 供电正极    |
| GND地线   | GND     | 供电负极    |
| DIN数据   | GPIO21  | RGB控制信号 |

#### TP4056充电模块连接

| 充电模块引脚   | 连接对象   | 功能说明   |
| -------- | ------ | ------ |
| IN+电源输入  | 5V适配器+ | 充电输入正极 |
| IN-电源输入  | 5V适配器- | 充电输入负极 |
| B+电池正极   | 锂电池+   | 电池连接正极 |
| B-电池负极   | 锂电池-   | 电池连接负极 |
| OUT+输出正极 | 系统VCC  | 系统供电正极 |
| OUT-输出负极 | 系统GND  | 系统供电负极 |

## 软件开发

### 开发环境

* **编程语言**: MicroPython
* **开发平台**: ESP32 S3
* **通信协议**: UART (串口通信)
* **网络连接**: WiFi
* **音频格式**: WAV (16-bit, 16kHz, Mono)

### 主要功能

#### 1. EEG数据获取

* 通过UART接口接收TGAM芯片的脑电数据
* 支持8个EEG频段：Delta, Theta, LowAlpha, HighAlpha, LowBeta, HighBeta, LowGamma, MiddleGamma
* 实时数据帧解析和验证
* 数据格式：36字节帧，起始序列为 `0xAA 0xAA 0x20 0x02`

#### 2. 无线数据传输

* WiFi自动连接功能
* 支持UDP广播和HTTP指定后台上传两种方式
* 热点模式数据上传
* 支持服务器连通性检测
* 内存优化管理，防止内存溢出

#### 3. 语音状态提示系统

系统通过4个不同的音频文件提供状态反馈：

| 音频文件  | 播放时机        | 功能说明       |
| ----- | ----------- | ---------- |
| 1.wav | 设备启动时       | 提示开始连接WiFi |
| 2.wav | WiFi连接成功后   | 确认网络连接建立   |
| 3.wav | 检测到有效EEG数据时 | 确认开始接收脑电数据 |
| 4.wav | 数据异常或中断时    | 警告零数据或连接中断 |

#### 4. 异常处理机制

* WiFi连接超时检测
* 服务器连接状态监控
* EEG数据有效性验证
* 60秒数据中断超时提醒
* 内存不足自动回收

### 核心代码结构

```
main.py
├── 硬件初始化 (UART, I2S, WiFi)
├── 音频播放函数
├── 网络连接管理
├── EEG数据解析
├── 服务器通信
└── 主循环逻辑
```

### API接口

**数据上传接口**:

* URL: `http://192.168.2.124:9003/api/device/eeg/NB001`
* Method: POST
* Content-Type: `application/octet-stream`
* Data: 36字节二进制EEG数据帧

## 使用说明

1. **硬件连接**: 按照连接图正确连接所有模块
2. **软件烧录**: 将MicroPython固件和项目代码烧录到ESP32
3. **WiFi配置**: 修改代码中的WiFi名称和密码
4. **服务器配置**: 设置正确的后台服务器地址
5. **音频文件**: 将4个WAV音频文件上传到设备存储
6. **启动设备**: 打开三脚开关，设备自动开始工作

## 技术特点

* **低功耗设计**: 优化的睡眠和唤醒机制
* **实时处理**: 高效的数据流处理算法
* **可靠传输**: 多层错误检测和重试机制
* **用户友好**: 直观的语音状态提示
* **便携设计**: 电池供电，无线传输
* **多种传输模式**: 支持UDP广播和指定服务器上传
* **灵活部署**: 支持客户端模式和热点模式

## 项目文件结构

```
BrainwaveSensor/
├── Client/             # 客户端上传数据，分为UDP广播和指定后台上传两种方式
│   ├── main_udp.py     # 主程序文件
│   └── main_client.py  # 配置文件
├── Client-wav/         # 客户端音频文件提示音
│   ├── 1.wav          # WiFi连接提示音
│   ├── 2.wav          # 连接成功提示音
│   ├── 3.wav          # 数据接收提示音
│   └── 4.wav          # 异常警告提示音
├── LED/               # LED模块测试
│   └── led.py         # RGB指示灯测试代码
├── MAX98357/          # 音频模块测试
│   └── MAX98357.py    # I2S音频输出测试代码
├── Server/            # 热点模式上传数据
│   └── server.py      # 热点模式服务端代码
├── TGAM/              # EEG模块测试
│   └── tgam.py        # 脑电传感器通信测试
├── UART/              # 串口测试
│   └── uart.py        # 串口通信测试代码
├── WIFI/              # 无线模块测试
│   └── wifi.py        # WiFi连接测试代码
└── README.md          # 项目说明文档
```

## 模块说明

* **Client**: 核心客户端程序，实现完整的EEG数据采集和上传功能
* **Client-wav**: 存放语音提示音频文件
* **LED**: RGB指示灯功能测试和调试代码
* **MAX98357**: I2S音频输出模块的测试和验证代码
* **Server**: 热点模式下的服务端程序，用于接收客户端数据
* **TGAM**: EEG传感器模块的独立测试程序
* **UART**: 串口通信功能的基础测试代码
* **WIFI**: WiFi连接功能的独立测试和配置程序

